---
hostname: innangard
domain: v8r.io
action: sync
ssh:
  port: 2210
os:
  name: fedora
package:
  - curl
  - git
  - python3-pip
user:
  -
    username: chd
    authorized:
      keys:
        - ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAICqLZ8g4OEkYREvtocms3pUgdUVIxiJ+WZHv3ZsMROZL
  -
    username: grenade
    authorized:
      keys:
        - ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIPRO2rPB5URKyMSGeMwFd9Npzl/XywJWO9F2N/xylCVm
        - ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIGILqCEkUGPF3c+riHfLtkpsSP3nw/HjQUvTs66JsZ6a
        - ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIBUKD/88J7TtZdFiRTtCBtez8PwbCVQhKvJcwk5CtU7k
command:
  - sudo passwd -l root
  - timedatectl show | grep Timezone=UTC &> /dev/null || sudo timedatectl set-timezone UTC
  - systemctl is-active prometheus-node-exporter.service || sudo systemctl restart prometheus-node-exporter.service
  - systemctl is-active quilibrium.service || sudo systemctl restart quilibrium.service
archive:
  -
    source: https://github.com/prometheus/node_exporter/releases/download/v1.8.1/node_exporter-1.8.1.linux-amd64.tar.gz
    target: /tmp/node_exporter-1.8.1.linux-amd64.tar.gz
    sha256: fbadb376afa7c883f87f70795700a8a200f7fd45412532cc1938a24d41078011
    extract:
      -
        source: node_exporter-1.8.1.linux-amd64/node_exporter
        target: /usr/local/bin/node_exporter
        sha256: 5f9fb023724051a76a9e455c25d83b8d5ba91b8f3d83da9666cd7f1c6d57e30e
        command:
          pre:
            - systemctl is-active --quiet prometheus-node-exporter.service && sudo systemctl stop prometheus-node-exporter.service
          post:
            - sudo systemctl daemon-reload
            - sudo systemctl start prometheus-node-exporter.service
file:
  -
    source: https://raw.githubusercontent.com/grenade/rubberneck/main/static/etc/ssh/sshd_config.d/39-ed25519-only.conf
    target: /etc/ssh/sshd_config.d/39-ed25519-only.conf
    command:
      post:
        - sudo systemctl restart sshd.service
  -
    source: https://raw.githubusercontent.com/grenade/rubberneck/main/static/etc/systemd/system/prometheus-node-exporter.service
    target: /etc/systemd/system/prometheus-node-exporter.service
    command:
      pre:
        - systemctl is-active --quiet prometheus-node-exporter.service && sudo systemctl stop prometheus-node-exporter.service
      post:
        - sudo systemctl daemon-reload
        - systemctl is-enabled prometheus-node-exporter.service || sudo systemctl enable prometheus-node-exporter.service
        - systemctl is-active prometheus-node-exporter.service || sudo systemctl start prometheus-node-exporter.service
  -
    source: https://raw.githubusercontent.com/grenade/rubberneck/main/static/etc/systemd/system/quilibrium.service
    target: /etc/systemd/system/quilibrium.service
    command:
      pre:
        - systemctl is-active --quiet quilibrium.service && sudo systemctl stop quilibrium.service
        - id quilibrium || sudo useradd --system --create-home --home-dir /var/lib/quilibrium --user-group quilibrium
        - sudo -u quilibrium mkdir -p /var/lib/quilibrium/.node
      post:
        - sudo systemctl daemon-reload
        - systemctl is-enabled quilibrium.service || sudo systemctl enable quilibrium.service
        - sudo systemctl start quilibrium.service
  -
    source: https://releases.quilibrium.com/node-2.0.0.1-linux-amd64
    target: /var/lib/quilibrium/.local/bin/quilibrium
    sha256: ce852b03aeee98ca7f769df85d29d0ce8f10836a9076f289a0c36e5939a537b7
    chown: quilibrium:quilibrium
    chmod: '+x'
    command:
      pre:
        - systemctl is-active --quiet quilibrium.service && sudo systemctl stop quilibrium.service
        - id quilibrium || sudo useradd --system --create-home --home-dir /var/lib/quilibrium --user-group quilibrium
        - sudo -u quilibrium mkdir -p /var/lib/quilibrium/.local/bin
      post:
        - sudo chown quilibrium:quilibrium /var/lib/quilibrium/.local/bin/quilibrium
        - sudo semanage fcontext -a -t bin_t /var/lib/quilibrium/.local/bin/quilibrium
        - sudo chcon -Rv -u system_u -t bin_t /var/lib/quilibrium/.local/bin/quilibrium
        #- sudo restorecon -R -v /var/lib/quilibrium/.local/bin/quilibrium
        - sudo systemctl daemon-reload
        - systemctl is-enabled quilibrium.service || sudo systemctl enable quilibrium.service
          sudo systemctl start quilibrium.service
  -
    source: https://releases.quilibrium.com/node-2.0.0.1-linux-amd64.dgst
    target: /var/lib/quilibrium/.local/bin/quilibrium.dgst
    sha256: 8827a48d3f52216118eea26041f1c63d81000485f2b87ca18675c7e7cbd2983c
    chown: quilibrium:quilibrium
  -
    source: https://releases.quilibrium.com/node-2.0.0.1-linux-amd64.dgst.sig.1
    target: /var/lib/quilibrium/.local/bin/quilibrium.dgst.sig.1
    sha256: 2859275c94804698b56f3f9d5ad2da3298586641dd555672842962d3c61ad2af
    chown: quilibrium:quilibrium
  -
    source: https://releases.quilibrium.com/node-2.0.0.1-linux-amd64.dgst.sig.2
    target: /var/lib/quilibrium/.local/bin/quilibrium.dgst.sig.2
    sha256: 891edba8ad663bf551796d8da76c50ce0dfd9f6f6500db57eeaa8a98f44c2294
    chown: quilibrium:quilibrium
  -
    source: https://releases.quilibrium.com/node-2.0.0.1-linux-amd64.dgst.sig.3
    target: /var/lib/quilibrium/.local/bin/quilibrium.dgst.sig.3
    sha256: 891edba8ad663bf551796d8da76c50ce0dfd9f6f6500db57eeaa8a98f44c2294
    chown: quilibrium:quilibrium
  -
    source: https://releases.quilibrium.com/node-2.0.0.1-linux-amd64.dgst.sig.4
    target: /var/lib/quilibrium/.local/bin/quilibrium.dgst.sig.4
    sha256: d06bfaa7a55570517ba0feb2511585c7bbe1d6db3d2dae45e37e81217854ff71
    chown: quilibrium:quilibrium
  -
    source: https://releases.quilibrium.com/node-2.0.0.1-linux-amd64.dgst.sig.6
    target: /var/lib/quilibrium/.local/bin/quilibrium.dgst.sig.6
    sha256: 5a7a7fb8ff4d239ad70c23838da48f98f98ff77b6b5fb90722ea3538e0368fbf
    chown: quilibrium:quilibrium
  -
    source: https://releases.quilibrium.com/node-2.0.0.1-linux-amd64.dgst.sig.8
    target: /var/lib/quilibrium/.local/bin/quilibrium.dgst.sig.8
    sha256: 52bb73c7ac4a78dd6a66e48db1d26c910ce2fc3df8e968bbdd13a5a9f66b5e7e
    chown: quilibrium:quilibrium
  -
    source: https://releases.quilibrium.com/node-2.0.0.1-linux-amd64.dgst.sig.13
    target: /var/lib/quilibrium/.local/bin/quilibrium.dgst.sig.13
    sha256: 9ef614e90e8fbb4ee834db2370e79ec9c7e39aa54fa667608f7f184cc6fea86a
    chown: quilibrium:quilibrium
  -
    source: https://releases.quilibrium.com/node-2.0.0.1-linux-amd64.dgst.sig.15
    target: /var/lib/quilibrium/.local/bin/quilibrium.dgst.sig.15
    sha256: 1396e83e2fea52d35bfd0e0fe01aa80fea2c5ec8ee4209e3e156473e41d1ba04
    chown: quilibrium:quilibrium
  -
    source: https://releases.quilibrium.com/node-2.0.0.1-linux-amd64.dgst.sig.16
    target: /var/lib/quilibrium/.local/bin/quilibrium.dgst.sig.16
    sha256: 4ad09e81a434cf14fdf73613c90da0909e1aba43f302f9e4c05fc9caea788fe9
    chown: quilibrium:quilibrium
  -
    source: https://releases.quilibrium.com/node-2.0.0.1-linux-amd64.dgst.sig.17
    target: /var/lib/quilibrium/.local/bin/quilibrium.dgst.sig.17
    sha256: aea6ef6afa543bc8e34328b12f3ab6ae4350a15bc67f9054d25fdaa885387432
    chown: quilibrium:quilibrium
  -
    source: https://raw.githubusercontent.com/grenade/rubberneck/main/static/etc/sysctl.d/90-quilibrium.conf
    target: /etc/sysctl.d/90-quilibrium.conf
    command:
      post:
        - sudo sysctl -w net.core.rmem_max=4194304
        - sudo sysctl -w net.core.wmem_max=4194304
